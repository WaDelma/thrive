
buildscript {
    repositories {
        jcenter()
        maven {
            url = uri("https://plugins.gradle.org/m2/")
        }
        flatDir {
            dirs = [new File("libs"),]
        }
    }
    dependencies {
        classpath("me.champeau.gradle:jmh-gradle-plugin:0.4.8")
    }
}

plugins {
    id("org.jetbrains.kotlin.jvm") version "1.3.41"
    id("me.champeau.gradle.jmh") version "0.4.8"
}

version = "1.0-SNAPSHOT"

repositories {
    mavenCentral()
}

dependencies {
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    testCompile("junit:junit:4.12")
    testCompile("org.jetbrains.kotlin:kotlin-test-junit:1.3.41")
    compile("org.freemarker:freemarker:2.3.23")
    compile("commons-io:commons-io:2.4")
}

jmh {
    dependencies {
        implementation("org.organicdesign:Paguro-KF:3.5.6")
    }
}

tasks {
    test {
        maxHeapSize = "12G"
    }
    compileKotlin {
        kotlinOptions.jvmTarget = "1.8"
    }
    task fmpp {
        group = "sample"
        def fromDir = "$projectDir/src/templates"
        def intoDir = "$projectDir/src/jmh/java/thrive"
        doLast {
            ant.taskdef(name: "fmpp", classname: "fmpp.tools.AntTask") {
                classpath {
                    fileset(dir: "libs", includes: "*.jar")
                }
            }
            ant.fmpp(
                    sourceRoot: fromDir,
                    outputRoot: intoDir,
                    data: """
                        STRUCTURES: [
                            {
                                type: 'Trie1<Integer>'
                                creator: 'new Trie1<Integer>()'
                                path: 'thrive.Trie1'
                                insert: 'insert'
                                name: 'Trie1'
                            },
                            {
                                type: 'Trie2<Integer>'
                                creator: 'new Trie2<Integer>()'
                                path: 'thrive.Trie2'
                                insert: 'insert'
                                name: 'Trie2'
                            },
                            {
                                type: 'PersistentHashMap<Integer, Integer>'
                                creator: 'PersistentHashMap.empty()'
                                path: 'org.organicdesign.fp.collections.PersistentHashMap'
                                insert: 'assoc'
                                name: 'PersistentHashMap'
                            },
                            {
                                type: 'PersistentTreeMap<Integer, Integer>'
                                creator: 'PersistentTreeMap.empty()'
                                path: 'org.organicdesign.fp.collections.PersistentTreeMap'
                                insert: 'assoc'
                                name: 'PersistentTreeMap'
                            },
                            {
                                type: 'RrbTree<Integer>'
                                creator: 'RrbTree.empty()'
                                path: 'org.organicdesign.fp.collections.RrbTree'
                                insert: 'insert'
                                name: 'RrbTree'
                            }
                        ]
                    """
            )
        }
    }
}

